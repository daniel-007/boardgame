<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="boardgame-fading-text">
  <template>
    <style>

      #container {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
        @apply --layout-vertical;
        @apply --layout-center;
        @apply --layout-center-justified;
        visibility: hidden;
        pointer-events: none;
      }

      #container.animating {
        visibility: visible;
      }

      #message {
        font-size: var(--message-font-size, 16px);
      }

      .animating #message {
        animation-name: fadetext;
        animation-duration: var(--animation-length, 0.25s);
        animation-timing-function: ease-out;
      }

      @keyframes fadetext {
        from {
          opacity: 1.0;
          transform: scale(1.0);
        }
        to {
          opacity: 0.0;
          transform: scale(6.0);
        }
      }

    </style>

    <div id="container" class$="{{_classes(_animating)}}">
      <div id="message">
        {{message}}
      </div>
    </div>

  </template>

  <script>

    class BoardgameFadingText extends Polymer.Element {

      static get is() {
        return "boardgame-fading-text";
      }

      static get properties() {
        return {
          //The message to show. If autoMessage is set to something other than
          //'fixed' this will be set based on trigger.
          message: {
            type: String,
            value: "Point Scored",
          },
          //When Trigger changes, the element will animate.
          trigger: {
            type: Object,
            observer: "_triggerChanged",
          },
          //Values: 'fixed' - no change, 'new' - autoamtically set to
          //newvalue, 'diff' - if both new and old are numbers, set to the
          //difference.
          autoMessage: {
            type: String,
            value: "fixed",
          },
          _animating: Boolean,
        }
      }

      ready() {
        super.ready()
        this.$.message.addEventListener("animationend", () => this._animationEnded());
      }

      _animationEnded() {
        this._animating = false;
      }

      animate() {
        this._animating = true;
      }

      _triggerChanged(newValue, oldValue) {
        if (oldValue === undefined) return;

        switch (this.autoMessage) {
          case "diff":
            if (typeof newValue == "number" && typeof oldValue == "number") {
              this.message = newValue - oldValue;
            } else {
              this.message = newValue;
            }
            break;
          case "new":
            this.message = newValue;
            break;
        }

        this.animate();
      }

      _classes(_animating) {
        let classes = [];
        if (_animating) {
          classes.push("animating");
        }
        return classes.join(" ");
      }
    }

    customElements.define(BoardgameFadingText.is, BoardgameFadingText);

  </script>
</dom-module>
