<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-styles/shadow.html">
<link rel="import" href="../bower_components/paper-styles/typography.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="boardgame-card">
  <template>
    <style include="iron-flex">

      .spacer {
        visibility: hidden;
      }

      #card div.fallback {
        display:none;
      }

      #card.no-content div.normal {
        display:none;
      }

      #card.no-content div.fallback {
        display:block;
      }

      #front>div {
        height: 100%;
        width: 100%;
      }

      #card {
        height: 4em;
        width: 6em;
        @apply --layout-vertical;
        @apply --layout-center;
        @apply --layout-center-justified;
        cursor: default;
        perspective: 1000px;
      }

      #card.face-up .inner {
        transform: rotateY(180deg);
      }

      #card.rotated {
        height: 6em;
        width: 4em;
      }

      #card.interactive {
        cursor: pointer;
      }

      .inner {
        height: 4em;
        width: 6em;

        border-radius: 0.25em;

        transform-style: preserve-3d;
        position: relative;
        transition: transform var(--animation-length, 0.25s) ease-in-out, var(--shadow-transition_-_transition);
      }

      .no-animate .inner {
        transition: unset;
      }

      .disabled .inner {
        filter: saturate(20%) brightness(125%);
      }

      .rotated .inner {
        transform: rotate(-90deg);
      }

      #card.shadow .inner {
        @apply --shadow-elevation-2dp;
      }

      #card.shadow.interactive:hover .inner {
        @apply --shadow-elevation-8dp;
      }

      #front, #back {
        height:100%;
        width:100%;
        position:absolute;
        top:0;
        left: 0;
        backface-visibility: hidden;
        overflow: hidden;
      }

      #card #front {
        background-color: #CCFCFC;
        z-index: 2;
        transform: rotateY(180deg);
      }

      #card #back {
        background-color: #00CCCC;
        transform: rotateY(0deg);
      }

      #default-back {
        height:100%;
        width:120%;
        opacity: 0.2;
        font-size: 13.5px;
        line-height: 14px;
        overflow: hidden;
        text-overflow:clip;
        user-select:none;
        @apply --layout-vertical;
        @apply --layout-center;
        @apply --layout-center-justified;
      }

    </style>

    <div id="card" class$="{{_classes(faceUp, spacer, noShadow, rotated, interactive, disabled, noContent, noAnimate)}}" on-tap="handleTap">
      <div class="inner">
        <div id="front">
          <div class="normal">
            <slot>
              {{suit}}{{rank}}
            </slot>
          </div>
          <div class="fallback">
            <slot name="fallback"></slot>
          </div>
        </div>
        <div id="back">
          <slot name="back">
            <div id="default-back">
                  &#x2605; &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606; &#x2605;  &#x2606;
            </div>
          </slot>
        </div>
      </div>
    </div>
  </template>

  <script>

    class BoardgameCard extends Polymer.Element {

      static get is() {
        return "boardgame-card"
      }

      static get properties() {
        return {
          suit: String,
          rank: String,
          index: Number,
          item: {
            type: Object,
            observer: "_itemChanged"
          },
          faceUp: Boolean,
          rotated: Boolean,
          //If true, will show old content, not normal front conten
          noContent: {
            type: Boolean,
            value: false,
          },
          noAnimate: {
            type: Boolean,
            value: false
          },
          id: String,
          disabled: {
            type: Boolean,
            value: false
          },
          interactive: {
            type: Boolean,
            readOnly: true,
            computed: "_computeInteractive(spacer, disabled)"
          },
          spacer: {
            type: Boolean,
            reflectToAttribute: true,
            value: false
          },
          noShadow: Boolean,
        }
      }

      handleTap(e) {
        if (!this.interactive) {
          return;
        }
        this.dispatchEvent(new CustomEvent('card-tapped', {composed: true, detail: {index: this.index}}));
      }

      _itemChanged(newValue) {
        if (newValue === undefined) return;
        if (newValue === null) {
          this.spacer = true;
          this.noContent = true;
          this.faceUp = false;
          return;
        }
        if (newValue.Values) {
          this.faceUp = true;
          this.noContent = false;
        } else {
          this.faceUp = false;
          this.noContent = true;
        }
        this.id = newValue.Id || "";
      }

      _computeInteractive(spacer, disabled) {
        return !spacer && !disabled;
      }

      _classes(faceUp, spacer, noShadow, rotated, interactive, disabled, noContent, noAnimate) {
        let result = ["card"];
        if (faceUp) {
          result.push("face-up");
        }
        if (spacer) {
          result.push("spacer");
        }
        if (!noShadow) {
          result.push("shadow");
        }
        if (rotated) {
          result.push("rotated");
        }
        if (interactive) {
          result.push("interactive");
        }
        if (disabled) {
          result.push("disabled");
        }
        if (noContent) {
          result.push("no-content")
        }
        if (noAnimate) {
          result.push("no-animate")
        }
        return result.join(" ");
      }
    }

    customElements.define(BoardgameCard.is, BoardgameCard);
  </script>
</dom-module>
