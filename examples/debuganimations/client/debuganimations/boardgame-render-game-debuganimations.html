<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../src/boardgame-card.html">
<link rel="import" href="../../src/boardgame-card-stack.html">

<dom-module id="boardgame-render-game-debuganimations">
  <template>
    <style>

      #shortstacks {
        @apply --layout-horizontal;
      }

      #draw {
        @apply --layout-horizontal;
      }

      #shortstacks boardgame-card > div {
        @apply --layout-horizontal;
        @apply --layout-center;
        @apply --layout-center-justified;
      }

      #fan {
        @apply --layout-horizontal;
      }

      .flex {
        @apply --layout-flex;
      }

      .controls {
        @apply --layout-vertical;
      }

      #hidden {
        @apply --layout-horizontal;
      }

    </style>

    <div id='shortstacks'>
      <boardgame-card-stack layout='stack' stack="{{state.Game.FirstShortStack}}" messy>
        <template is='dom-repeat'>
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <boardgame-card-stack layout='stack' messy stack="{{state.Game.SecondShortStack}}">
        <template is='dom-repeat'>
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <paper-button move-name="Move Card Between Short Stacks">Swap</paper-button>
    </div>

    <div id='draw'>
      <boardgame-card-stack layout='stack' messy stack="{{state.Game.DrawStack}}">
        <template is='dom-repeat'>
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <boardgame-card-stack layout='stack' messy stack="{{state.Game.DiscardStack}}">
        <template is='dom-repeat'>
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <paper-button move-name="Move Card Between Draw and Discard Stacks">Draw</paper-button>
    </div>

    <div id='draw'>
      <boardgame-card-stack layout='stack' messy primary-stack="{{state.Game.HiddenCard}}" secondary-stack="{{state.Game.RevealedCard}}"> 
        <template is='dom-repeat'>
          <boardgame-card index="{{index}}" item="{{item}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <paper-button move-name="Flip Card Between Hidden and Revealed">Flip</paper-button>
    </div>

    <div id="fan">
      <boardgame-card-stack layout='{{fromStackLayout}}' messy stack="{{state.Game.FanStack}}">
        <template is='dom-repeat'>
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <div class="flex"></div>
      <boardgame-card-stack layout='stack' messy stack="{{state.Game.FanDiscard}}">
        <template is='dom-repeat'>
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <div class="controls">
        <paper-button move-name="Move Fan Card">Draw</paper-button>
        <paper-button move-name="Visible Shuffle">Public Shuffle</paper-button>
        <paper-button move-name="Shuffle">Shuffle</paper-button>
        <paper-dropdown-menu label="Layout">
          <paper-listbox slot="dropdown-content" selected="{{fromStackLayout}}" attr-for-selected="value">
            <paper-item value="fan">fan</paper-item>
            <paper-item value="hand">hand</paper-item>
            <paper-item value="stack">stack</paper-item>
            <paper-item value="grid">grid</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
      </div>
    </div>

    <div id="hidden">
      <boardgame-card-stack layout="fan" messy stack="{{state.Game.VisibleStack}}">
        <template is="dom-repeat">
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <boardgame-card-stack layout="stack" messy stack="{{state.Game.HiddenStack}}">
        <template is="dom-repeat">
          <boardgame-card item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-stack>
      <paper-button move-name="Move Between Hidden">Draw</paper-button>
    </div>

  </template>

  <script>

    class BoardgameRenderGameDebuganimations extends Polymer.Element {

      static get is() {
        return "boardgame-render-game-debuganimations"
      }

      static get properties() {
        return {
          state: Object,
          diagram : String,
          fromStackLayout: {
            type: String,
            value: "fan"
          }
        }
      }

      ready() {
        super.ready();
        this.addEventListener("tap", e => this._handleButtonTapped(e));
      }

      _handleButtonTapped(e) {
        var ele = e.composedPath()[0];
        var moveName = ele.getAttribute("move-name");
        if (!moveName) return;
        this.dispatchEvent(new CustomEvent("propose-move", {composed: true, detail: {name: moveName, arguments:{}}}));
      }

    }

    customElements.define(BoardgameRenderGameDebuganimations.is, BoardgameRenderGameDebuganimations);

  </script>
</dom-module>
