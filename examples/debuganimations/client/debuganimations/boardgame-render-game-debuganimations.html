<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../src/boardgame-card.html">
<link rel="import" href="../../src/boardgame-card-collection.html">

<dom-module id="boardgame-render-game-debuganimations">
  <template>
    <style>

      #shortstacks {
        @apply --layout-horizontal;
      }

      #draw {
        @apply --layout-horizontal;
      }

      #shortstacks boardgame-card > div {
        @apply --layout-horizontal;
        @apply --layout-center;
        @apply --layout-center-justified;
      }

      #fan {
        @apply --layout-horizontal;
      }

      .flex {
        @apply --layout-flex;
      }
    </style>

    <div id='shortstacks'>
      <boardgame-card-collection layout='stack' messy ids-last-seen="{{state.Game.FirstShortStack.IdsLastSeen}}">
        <template is='dom-repeat' items='{{state.Game.FirstShortStack.Components}}'>
          <boardgame-card component-item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-collection>
      <boardgame-card-collection layout='stack' messy ids-last-seen="{{state.Game.SecondShortStack.IdsLastSeen}}">
        <template is='dom-repeat' items='{{state.Game.SecondShortStack.Components}}'>
          <boardgame-card component-item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-collection>
      <paper-button on-tap="handleSwapTapped">Swap</paper-button>
    </div>

    <div id='draw'>
      <boardgame-card-collection layout='stack' messy ids-last-seen="{{state.Game.DrawStack.IdsLastSeen}}">
        <template is='dom-repeat' items='{{state.Game.DrawStack.Components}}'>
          <boardgame-card component-item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-collection>
      <boardgame-card-collection layout='stack' messy ids-last-seen="{{state.Game.DiscardStack.IdsLastSeen}}">
        <template is='dom-repeat' items='{{state.Game.DiscardStack.Components}}'>
          <boardgame-card component-item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-collection>
      <paper-button on-tap="handleDrawTapped">Draw</paper-button>
    </div>

    <div id='draw'>
      <boardgame-card-collection layout='stack' messy>
        <template is='dom-repeat' items='{{singleCard(state)}}'>
          <boardgame-card index="{{index}}" component-item="{{item}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-collection>
      <paper-button on-tap="handleFlipTapped">Flip</paper-button>
    </div>

    <div id="fan">
      <boardgame-card-collection layout='{{fromStackLayout}}' messy ids-last-seen="{{state.Game.FanStack.IdsLastSeen}}">
        <template is='dom-repeat' items='{{state.Game.FanStack.Components}}'>
          <boardgame-card component-item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-collection>
      <div class="flex"></div>
      <boardgame-card-collection layout='stack' messy ids-last-seen="{{state.Game.FanDiscard.IdsLastSeen}}">
        <template is='dom-repeat' items='{{state.Game.FanDiscard.Components}}'>
          <boardgame-card component-item="{{item}}" index="{{index}}">
            <div>
              {{item.Values.Type}}
            </div>
          </boardgame-card>
        </template>
      </boardgame-card-collection>
      <paper-button on-tap="handleFanTapped">Draw</paper-button>
      <paper-dropdown-menu label="Layout">
        <paper-listbox slot="dropdown-content" selected="{{fromStackLayout}}" attr-for-selected="value">
          <paper-item value="fan">fan</paper-item>
          <paper-item value="hand">hand</paper-item>
          <paper-item value="stack">stack</paper-item>
          <paper-item value="grid">grid</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
    </div>

  </template>

  <script>

    class BoardgameRenderGameDebuganimations extends Polymer.Element {

      static get is() {
        return "boardgame-render-game-debuganimations"
      }

      static get properties() {
        return {
          state: Object,
          diagram : String,
          fromStackLayout: {
            type: String,
            value: "fan"
          }
        }
      }

      handleSwapTapped(e) {
        this.dispatchEvent(new CustomEvent("propose-move", {composed: true, detail: {name: "Move Card Between Short Stacks", arguments:{}}}));
      }

      handleDrawTapped(e) {
        this.dispatchEvent(new CustomEvent("propose-move", {composed: true, detail: {name: "Move Card Between Draw and Discard Stacks", arguments:{}}}));
      }

      handleFlipTapped(e) {
        this.dispatchEvent(new CustomEvent("propose-move", {composed: true, detail: {name: "Flip Card Between Hidden and Revealed", arguments:{}}}));
      }

      handleFanTapped(e) {
        this.dispatchEvent(new CustomEvent("propose-move", {composed: true, detail: {name: "Move Fan Card", arguments:{}}}));
      }

      singleCard(state) {
        var result = [];

        if (!state) return result;

        if (state.Game.HiddenCard.Components[0]) {
          result.push(state.Game.HiddenCard.Components[0]);
        } else {
          result.push(state.Game.RevealedCard.Components[0]);
        }

        return result;
      }

    }

    customElements.define(BoardgameRenderGameDebuganimations.is, BoardgameRenderGameDebuganimations);

  </script>
</dom-module>
